project(':spark') {
    apply plugin: 'scala'

    configurations.all {
        if (name.startsWith("incrementalScalaAnalysis")) {
            extendsFrom = []
        }
    }

    sourceSets.main.scala.srcDirs 'src/main/java'
    sourceSets.main.java.srcDirs = []

    dependencies {
        implementation project(':gorbase')
        implementation project(':model')
        implementation(project(':gortools')) {
            exclude group: 'net.sourceforge.f2j', module: 'arpack_combined_all'
        }

        /*compile("${gorArtifactGroupId}:gor-base-config:${gorVersion}")
        compile("${gorArtifactGroupId}:gor-base-logging:${gorVersion}")
        compile("${gorArtifactGroupId}:gor-base-exception:${gorVersion}")
        compile("${gorArtifactGroupId}:gor-model:${gorVersion}")
        compile("${gorArtifactGroupId}:gor-gortools:${gorVersion}")*/

        implementation ('org.glassfish.jaxb:jaxb-runtime:2.3.2')
        implementation ('jakarta.xml.bind:jakarta.xml.bind-api:2.3.2')

        implementation ('org.apache.spark:spark-core_2.12:3.0.1') {
            exclude group: 'com.fasterxml.jackson.core', module: 'jackson-core'
            exclude group: 'com.fasterxml.jackson.core', module: 'jackson-databind'
            exclude group: 'com.fasterxml.jackson.module', module: 'jackson-module-scala'
            exclude group: 'org.apache.hadoop', module: 'hadoop-client'
            exclude group: 'org.apache.hadoop', module: 'hadoop-common'
            exclude group: 'org.apache.hadoop', module: 'hadoop-yarn-server-nodemanager'
        }
        implementation ('org.apache.spark:spark-sql_2.12:3.0.1') {
            exclude group: 'com.fasterxml.jackson.core', module: 'jackson-core'
            exclude group: 'com.fasterxml.jackson.core', module: 'jackson-databind'
            exclude group: 'com.fasterxml.jackson.module', module: 'jackson-module-scala'
            exclude group: 'org.apache.hadoop', module: 'hadoop-client'
            exclude group: 'org.apache.hadoop', module: 'hadoop-common'
            exclude group: 'org.apache.hadoop', module: 'hadoop-yarn-server-nodemanager'
        }
        implementation ('org.apache.spark:spark-mllib_2.12:3.0.1') {
            exclude group: 'com.fasterxml.jackson.core', module: 'jackson-core'
            exclude group: 'com.fasterxml.jackson.core', module: 'jackson-databind'
            exclude group: 'com.fasterxml.jackson.module', module: 'jackson-module-scala'
            exclude group: 'org.apache.hadoop', module: 'hadoop-client'
            exclude group: 'org.apache.hadoop', module: 'hadoop-common'
            exclude group: 'org.apache.hadoop', module: 'hadoop-yarn-server-nodemanager'
            exclude group: 'net.sourceforge.f2j', module: 'arpack_combined_all'
        }
        implementation ('org.apache.spark:spark-tags_2.12:3.0.1') {
            exclude group: 'com.fasterxml.jackson.core', module: 'jackson-core'
            exclude group: 'com.fasterxml.jackson.core', module: 'jackson-databind'
            exclude group: 'com.fasterxml.jackson.module', module: 'jackson-module-scala'
            exclude group: 'org.apache.hadoop', module: 'hadoop-client'
            exclude group: 'org.apache.hadoop', module: 'hadoop-common'
            exclude group: 'org.apache.hadoop', module: 'hadoop-yarn-server-nodemanager'
        }
        implementation ('org.apache.spark:spark-kubernetes_2.12:3.0.1') {
            exclude group: 'com.fasterxml.jackson.core', module: 'jackson-core'
            exclude group: 'com.fasterxml.jackson.core', module: 'jackson-databind'
            exclude group: 'com.fasterxml.jackson.module', module: 'jackson-module-scala'
            exclude group: 'org.apache.spark', module: 'spark-tags_2.12'
            exclude group: 'org.apache.hadoop', module: 'hadoop-client'
            exclude group: 'org.apache.hadoop', module: 'hadoop-common'
        }
        /*implementation ('org.apache.spark:spark-hive_2.12:3.0.1') {
            exclude group: 'com.fasterxml.jackson.core', module: 'jackson-core'
            exclude group: 'com.fasterxml.jackson.core', module: 'jackson-databind'
            exclude group: 'com.fasterxml.jackson.module', module: 'jackson-module-scala'
            exclude group: 'org.apache.spark', module: 'spark-tags_2.12'
            exclude group: 'org.apache.hadoop', module: 'hadoop-yarn-server-nodemanager'
            exclude group: 'org.apache.hadoop', module: 'hadoop-client'
            exclude group: 'org.apache.hadoop', module: 'hadoop-common'
            exclude group: 'org.pentaho', module: 'pentaho-aggdesigner-algorithm'
        }
        implementation ('org.apache.spark:spark-hive-thriftserver_2.12:3.0.1') {
            exclude group: 'com.fasterxml.jackson.core', module: 'jackson-core'
            exclude group: 'com.fasterxml.jackson.core', module: 'jackson-databind'
            exclude group: 'com.fasterxml.jackson.module', module: 'jackson-module-scala'
            exclude group: 'org.apache.spark', module: 'spark-tags_2.12'
            exclude group: 'org.apache.hadoop', module: 'hadoop-client'
            exclude group: 'org.apache.hadoop', module: 'hadoop-common'
            exclude group: 'org.pentaho', module: 'pentaho-aggdesigner-algorithm'
        }*/
        implementation ('org.apache.spark:spark-catalyst_2.12:3.0.1') {
            exclude group: 'com.fasterxml.jackson.core', module: 'jackson-core'
            exclude group: 'com.fasterxml.jackson.core', module: 'jackson-databind'
            exclude group: 'org.apache.hadoop', module: 'hadoop-yarn-server-nodemanager'
            exclude group: 'com.fasterxml.jackson.module', module: 'jackson-module-scala'
            exclude group: 'org.apache.hadoop', module: 'hadoop-client'
            exclude group: 'org.apache.hadoop', module: 'hadoop-common'
        }
        implementation ('org.apache.spark:spark-repl_2.12:3.0.1') {
            exclude group: 'com.fasterxml.jackson.core', module: 'jackson-core'
            exclude group: 'com.fasterxml.jackson.core', module: 'jackson-databind'
            exclude group: 'com.fasterxml.jackson.module', module: 'jackson-module-scala'
            exclude group: 'org.apache.hadoop', module: 'hadoop-client'
            exclude group: 'org.apache.hadoop', module: 'hadoop-common'
            exclude group: 'org.apache.hadoop', module: 'hadoop-yarn-server-nodemanager'
        }

        compile group: 'com.redislabs', name: 'spark-redis_2.12', version: '2.5.0'

        compile group: 'com.fasterxml.jackson.core', name: 'jackson-core', version: '2.11.0'
        compile group: 'com.fasterxml.jackson.core', name: 'jackson-databind', version: '2.11.0'
        compile group: 'com.fasterxml.jackson.module', name: 'jackson-module-scala_2.12', version: '2.11.0'

        //implementation group: 'io.delta', name: 'delta-core_2.12', version: '0.7.0'

        /*compile('org.broadinstitute:gatk:4.1.4.1') {
            exclude group: 'com.esotericsoftware'
            exclude group: 'org.apache.commons', module: 'commons-vfs2'
            exclude group: 'org.apache.spark'
            exclude group: 'org.bdgenomics.adam'
        }
        compile group: 'org.broadinstitute', name: 'gatk-native-bindings', version: '1.0.0'*/

        compile group: 'org.apache.logging.log4j', name: 'log4j', version: '2.13.3'
        compile group: 'org.apache.logging.log4j', name: 'log4j-core', version: '2.13.3'
        compile group: 'org.apache.logging.log4j', name: 'log4j-api', version: '2.13.3'
        compile group: 'org.apache.logging.log4j', name: 'log4j-jcl', version: '2.13.3'
        compile group: 'org.apache.logging.log4j', name: 'log4j-slf4j-impl', version: '2.13.3'
        compile group: 'org.apache.logging.log4j', name: 'log4j-1.2-api', version: '2.13.3'

        //compile group: 'net.sourceforge.f2j', name: 'arpack_combined_all', version: '0.1'
        /*compile(group: 'org.apache.hive', name: 'hive-exec', version: '2.3.7') {
            exclude group: 'org.pentaho', module: 'pentaho-aggdesigner-algorithm'
        }*/
        compile group: 'org.apache.avro', name: 'avro-mapred', version: '1.8.2'

        implementation group: 'com.google.guava', name: 'guava', version: '29.0-jre'

        //compile group: 'javax.jms', name: 'javax.jms-api', version: '2.0.1'


        implementation 'io.projectglow:glow-spark3_2.12:0.6.0'
        //compile files('/Users/sigmar/glow/core/target/scala-2.12/glow_2.12-0.5.1-SNAPSHOT.jar')

        //implementation 'io.projectglow:glow:3.2.1'
        //implementation files('../hail/hail/build/libs/hail-all-spark.jar')
        //implementation files('../../glow/core/target/scala-2.12/glow_2.12-0.3.1-SNAPSHOT.jar')

        compile group: 'com.typesafe.scala-logging', name: 'scala-logging_2.12', version: '3.9.2'
        compile group: 'org.jdbi', name: 'jdbi', version: '2.78'
        /*compile (group: 'org.seqdoop', name: 'hadoop-bam', version: '7.10.0') {
            exclude group: 'com.google.guava', module: 'guava'
        }*/
        implementation group: 'com.google.protobuf', name: 'protobuf-java', version: '3.13.0'

        /*compile group: 'com.clearspring.analytics', name: 'stream', version: '2.9.8'
        compile group: 'com.esotericsoftware', name: 'kryo-shaded', version: '4.0.2'
        compile group: 'org.lz4', name: 'lz4-java', version: '1.7.0'
        compile group: 'org.apache.xbean', name: 'xbean-asm7-shaded', version: '4.15'
        compile group: 'com.univocity', name: 'univocity-parsers', version: '2.8.4'
        compile group: 'org.fusesource.leveldbjni', name: 'leveldbjni', version: '1.8'

        compile "org.codehaus.janino:janino:3.0.15"
        compile "org.codehaus.janino:commons-compiler:3.0.15"

        compile "org.json4s:json4s-core_2.12:3.6.7"
        compile "org.json4s:json4s-ast_2.12:3.6.7"
        compile "org.json4s:json4s-jackson_2.12:3.6.7"*/
        compile "org.apache.commons:commons-lang3:3.10"

        compile ('org.apache.hadoop:hadoop-common:3.3.0') {
            exclude group: 'com.google.guava', module: 'guava'
        }
        compile 'org.apache.hadoop:hadoop-client:3.3.0'
        compile ('org.apache.hadoop:hadoop-hdfs:3.3.0') {
            exclude group: 'com.google.guava', module: 'guava'
        }
        compile 'org.apache.hadoop:hadoop-hdfs-client:3.3.0'
        compile 'org.apache.hadoop:hadoop-aws:3.3.0'

        implementation("redis.clients:jedis:3.1.0")

        implementation 'io.kubernetes:client-java:9.0.2'
        //compile group: 'io.fabric8', name: 'kubernetes-client', version: '4.7.1'

        testImplementation project(':gortools')
        testImplementation project(':model')
        //testImplementation project(':test')
        //testCompile("${gorArtifactGroupId}:gor-test:${gorVersion}")
    }

    jar {
        manifest.attributes 'Main-Class': "gorsat.process.GorPipe"
    }

    // Distribution
    apply plugin: 'application'

    distributions {
        main {
            baseName "gor-scripts"
            /*contents {
                from(project(":documentation").jar.outputs.files.getFiles()) { into "lib" }
            }*/
        }
    }

    def scripts = [
            'gorpipe'   : ['className'     : 'org.gorpipe.spark.SparkPipe',
                           'defaultJvmOpts': ['-Djava.security.egd=file:/dev/./urandom',
                                              '-Dgor.querylimits.writequota.mb=0',
                                              '-Dgor.querylimits.timeout.seconds=0',
                                              '-Dlogback.configurationFile=__APP_HOME__/config/logback-console.xml']],

            'gor'       : ['className'     : 'org.gorpipe.gor.cli.GorCLI',
                           'defaultJvmOpts': ['-Djava.security.egd=file:/dev/./urandom',
                                              '-Dgor.querylimits.writequota.mb=0',
                                              '-Dgor.querylimits.timeout.seconds=0',
                                              '-Dlogback.configurationFile=__APP_HOME__/config/logback-console.xml']],

            'jessica'   : ['override'      : 'startScripts',
                           'className'     : 'org.gorpipe.jessica.Jessica',
                           'defaultJvmOpts': []],

            'gormanager': ['className'     : 'org.gorpipe.gor.manager.TableManagerCLI',
                           'defaultJvmOpts': ['-Djava.security.egd=file:/dev/./urandom',
                                              '-Dgor.querylimits.writequota.mb=0',
                                              '-Dgor.querylimits.timeout.seconds=0',
                                              '-Dlogback.configurationFile=__APP_HOME__/config/logback.xml']],

            'gortool'   : ['className'     : 'org.gorpipe.gor.tools.GorToolsCLI',
                           'defaultJvmOpts': ['-Dlogback.configurationFile=__APP_HOME__/config/logback.xml']]
    ]

    scripts.each() { scriptName, params ->
        def t = params.containsKey('override') ? tasks.getByName(params.override) : tasks.create(name: scriptName + 'StartScript', type: CreateStartScripts)
        updateScriptTask("GOR", scriptName, params, t, project)
    }
}

/*if (file("build.deploy.gradle").exists()) {
    apply from: "build.deploy.gradle"
}*/